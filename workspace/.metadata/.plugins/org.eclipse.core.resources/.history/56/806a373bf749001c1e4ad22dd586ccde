package fr.nkri.lobbyplugin.listener;


import org.bukkit.Bukkit;
import org.bukkit.GameMode;
import org.bukkit.Location;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerJoinEvent;
import org.bukkit.event.player.PlayerQuitEvent;
import org.bukkit.scoreboard.DisplaySlot;
import org.bukkit.scoreboard.Objective;
import org.bukkit.scoreboard.Scoreboard;
import org.bukkit.scoreboard.ScoreboardManager;

public class JoinEvent implements Listener {
	
	public Location lobby = new Location(Bukkit.getWorld("world"), -30, 3.0, -30);
	
	@EventHandler
	public void onJoin(PlayerJoinEvent e) {
		Player p = e.getPlayer();
		
		setPlayer(p);
		setScoreboard(p);
		e.setJoinMessage(p.getName() + " §ba rejoind le lobby.");
	}

	@EventHandler
	public void onQuit(PlayerQuitEvent e) {
		Player p = e.getPlayer();
		e.setQuitMessage(p.getName() + " §ba quitter le lobby.");
	}
	
	public void setPlayer(Player p) {
		
		//TODO spawn location du lobby
		p.setGameMode(GameMode.ADVENTURE);
		p.setHealth(20);
		p.setWalkSpeed((float) 0.3);
		p.setFoodLevel(20);
		
		p.getInventory().clear();
		p.getInventory().setArmorContents(null);
		p.setExp(0F);
		p.setLevel(0);
	}
	
	public void setScoreboard(Player p) {
		
		ScoreboardManager scoreboardManager = Bukkit.getScoreboardManager();
		Scoreboard scoreboard = scoreboardManager.getNewScoreboard();
		Objective obj = scoreboard.registerNewObjective("general", "dummy");
		
		obj.setDisplayName("§cMon Serveur");
		obj.setDisplaySlot(DisplaySlot.SIDEBAR);
		obj.getScore("§6 " + p.getName()).setScore(11);
		obj.getScore(" ").setScore(10);
		obj.getScore("§cip: §4play.serveur.fr").setScore(9);
		
		p.setScoreboard(scoreboard);
		
	}
	
	
	
}














